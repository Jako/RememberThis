/*!
 * RememberThis - Remember List for xPDO Objects
 * Version: 2.0.0
 * Build date: 2016-02-13
 */

!function(a,b,c,d){function e(b,c,d){this.options=a.extend({},g,c),this.$el=a(b),this.$other=a(this.options.listSelector).not(this.$el),this._defaults=g,this._name=f,this.init(d)}var f="rememberThis",g={ajaxLoaderImg:"",listSelector:".rememberthis",onBeforeAdd:function(a,b,c,d){},onBeforeDelete:function(a,b,c,d){},onAfterAdd:function(a,b,c,d){},onAfterDelete:function(a,b,c,d){}};e.prototype={init:function(b){var c=this;""!==c.options.ajaxLoaderImg?c.options.loadImage=a("<img>").addClass("rememberload").attr("src",c.options.ajaxLoaderImg):c.options.loadImage=a("<i>").addClass("fa fa-refresh fa-spin rememberload"),b&&(a(".rememberadd").on("click",function(b){b.preventDefault();var d=a(this).data("add");a(this).append(c.options.loadImage.clone()),c.options.onBeforeAdd.call(c.$el,c.$other,this,d,[]),c.onAdd(c.$el,c.$other,this,d,[]),c.options.onAfterAdd.call(c.$el,c.$other,this,d,[])}),a(".rememberaddform").on("submit",function(b){b.preventDefault();var d=a(this).data("add"),e={};a.each(a(this).serializeArray(),function(a,b){e.hasOwnProperty(b.name)?("string"==typeof e[b.name]&&(e[b.name]=[e[b.name]]),e[b.name].push(b.value)):e[b.name]=b.value}),a(this).append(c.options.loadImage.clone()),c.options.onBeforeAdd.call(c.$el,c.$other,this,d,e),c.onAdd(c.$el,c.$other,this,d,e),c.options.onAfterAdd.call(c.$el,c.$other,this,d,e)})),c.$el.on("click",".rememberdelete",function(b){b.preventDefault();var d=a(this).data("delete");a(this).hide().after(c.options.loadImage.clone()),c.options.onBeforeDelete.call(c.$el,c.$other,this,d),c.onDelete(c.$el,c.$other,this,d),c.options.onAfterDelete.call(c.$el,c.$other,this,d)})},onAdd:function(b,c,d,e,f){var g=this;a.ajax({type:"GET",url:g.options.connectorUrl,data:{language:g.options.language,action:"remember",add:e,addproperties:f},success:function(d){if(a(".rememberload").remove(),d.result)if(a(".rememberempty",b).length)b.slideUp("fast",function(){a(".remembercount").html(d.count),a(this).html(d.result).slideDown("slow")}),c.length&&c.each(function(){a(this).slideUp("fast",function(){a(this).html(a.trim(d.result)).slideDown("slow")})});else{var e=a(d.result).attr("style","display: none");b.append(e),a(".remembercount").html(d.count),c.length&&c.each(function(){var b=e.clone();a(this).append(b),b.slideDown("slow")}),e.slideDown("slow")}d.debug&&a(".rememberdebug").html(d.debug)}})},onDelete:function(b,c,d,e){var f=this;a.ajax({type:"GET",url:f.options.connectorUrl,data:{language:f.options.language,action:"remember","delete":e},success:function(e){if(e.count&&"0"!=e.count){var f=a(d).parent(),g=f.index();f.slideUp("slow",function(){a(".remembercount").html(e.count),a(this).remove()}),c.length&&c.each(function(){a(this).children().eq(g).slideUp("slow",function(){a(this).remove()})})}else b.slideUp("slow",function(){a(".remembercount").html(e.count),a(this).html(a.trim(e.result)).slideDown("fast")}),c.length&&c.each(function(){a(this).slideUp("slow",function(){a(this).html(a.trim(e.result)).slideDown("fast")})});e.debug&&a(".rememberdebug").html(e.debug)}})}},a.fn[f]=function(b){var c=arguments;if(b===d||"object"==typeof b){var g=!0;return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b,g)),g=!1})}if("string"==typeof b&&"_"!==b[0]&&"init"!==b){var h;return this.each(function(){var d=a.data(this,"plugin_"+f);d instanceof e&&"function"==typeof d[b]&&(h=d[b].apply(d,Array.prototype.slice.call(c,1))),"destroy"===b&&a.data(this,"plugin_"+f,null)}),h!==d?h:this}}}(jQuery,window,document);